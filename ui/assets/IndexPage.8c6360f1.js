import{c as B,a as g,h,d as j,aa as O,ab as Y,ac as W,ad as Z,r as q,g as F,i as J,C as ee,I as te,w as ae,f as se,T as ne,ae as ie,F as V,G as _,H as le,K as re,_ as oe,R as ce,af as m,U as v,V as b,W as d,a2 as N,X as c,a3 as z,$ as k,a1 as H,a0 as x,ag as ue,ah as de,Z as C,a6 as G,ai as he,a5 as ge,aj as me,Y as w}from"./index.73c93f01.js";import{u as fe}from"./session-store.e8ad8405.js";import"./axios.7fafc2de.js";var P=B({name:"QItemSection",props:{avatar:Boolean,thumbnail:Boolean,side:Boolean,top:Boolean,noWrap:Boolean},setup(e,{slots:t}){const a=g(()=>`q-item__section column q-item__section--${e.avatar===!0||e.side===!0||e.thumbnail===!0?"side":"main"}`+(e.top===!0?" q-item__section--top justify-start":" justify-center")+(e.avatar===!0?" q-item__section--avatar":"")+(e.thumbnail===!0?" q-item__section--thumbnail":"")+(e.noWrap===!0?" q-item__section--nowrap":""));return()=>h("div",{class:a.value},j(t.default))}}),ve=B({name:"QItem",props:{...O,...Y,tag:{type:String,default:"div"},active:{type:Boolean,default:null},clickable:Boolean,dense:Boolean,insetLevel:Number,tabindex:[String,Number],focused:Boolean,manualFocus:Boolean},emits:["click","keyup"],setup(e,{slots:t,emit:a}){const{proxy:{$q:s}}=F(),y=W(e,s),{hasLink:i,linkAttrs:o,linkClass:r,linkTag:u,navigateOnClick:p}=Z(),f=q(null),$=q(null),D=g(()=>e.clickable===!0||i.value===!0||e.tag==="label"),S=g(()=>e.disable!==!0&&D.value===!0),R=g(()=>"q-item q-item-type row no-wrap"+(e.dense===!0?" q-item--dense":"")+(y.value===!0?" q-item--dark":"")+(i.value===!0&&e.active===null?r.value:e.active===!0?` q-item--active${e.activeClass!==void 0?` ${e.activeClass}`:""}`:"")+(e.disable===!0?" disabled":"")+(S.value===!0?" q-item--clickable q-link cursor-pointer "+(e.manualFocus===!0?"q-manual-focusable":"q-focusable q-hoverable")+(e.focused===!0?" q-manual-focusable--focused":""):"")),I=g(()=>{if(e.insetLevel===void 0)return null;const l=s.lang.rtl===!0?"Right":"Left";return{["padding"+l]:16+e.insetLevel*56+"px"}});function Q(l){S.value===!0&&($.value!==null&&(l.qKeyEvent!==!0&&document.activeElement===f.value?$.value.focus():document.activeElement===$.value&&f.value.focus()),p(l))}function A(l){if(S.value===!0&&J(l,13)===!0){ee(l),l.qKeyEvent=!0;const L=new MouseEvent("click",l);L.qKeyEvent=!0,f.value.dispatchEvent(L)}a("keyup",l)}function K(){const l=te(t.default,[]);return S.value===!0&&l.unshift(h("div",{class:"q-focus-helper",tabindex:-1,ref:$})),l}return()=>{const l={ref:f,class:R.value,style:I.value,role:"listitem",onClick:Q,onKeyup:A};return S.value===!0?(l.tabindex=e.tabindex||"0",Object.assign(l,o.value)):D.value===!0&&(l["aria-disabled"]="true"),h(u.value,l,K())}}}),ye=B({name:"QList",props:{...O,bordered:Boolean,dense:Boolean,separator:Boolean,padding:Boolean,tag:{type:String,default:"div"}},setup(e,{slots:t}){const a=F(),s=W(e,a.proxy.$q),y=g(()=>"q-list"+(e.bordered===!0?" q-list--bordered":"")+(e.dense===!0?" q-list--dense":"")+(e.separator===!0?" q-list--separator":"")+(s.value===!0?" q-list--dark":"")+(e.padding===!0?" q-list--padding":""));return()=>h(e.tag,{class:y.value},j(t.default))}});const be={ratio:[String,Number]};function ke(e,t){return g(()=>{const a=Number(e.ratio||(t!==void 0?t.value:void 0));return isNaN(a)!==!0&&a>0?{paddingBottom:`${100/a}%`}:null})}const qe=16/9;var Ce=B({name:"QImg",props:{...be,src:String,srcset:String,sizes:String,alt:String,crossorigin:String,decoding:String,referrerpolicy:String,draggable:Boolean,loading:{type:String,default:"lazy"},fetchpriority:{type:String,default:"auto"},width:String,height:String,initialRatio:{type:[Number,String],default:qe},placeholderSrc:String,fit:{type:String,default:"cover"},position:{type:String,default:"50% 50%"},imgClass:String,imgStyle:Object,noSpinner:Boolean,noNativeMenu:Boolean,noTransition:Boolean,spinnerColor:String,spinnerSize:String},emits:["load","error"],setup(e,{slots:t,emit:a}){const s=q(e.initialRatio),y=ke(e,s);let i=null,o=!1;const r=[q(null),q(Q())],u=q(0),p=q(!1),f=q(!1),$=g(()=>`q-img q-img--${e.noNativeMenu===!0?"no-":""}menu`),D=g(()=>({width:e.width,height:e.height})),S=g(()=>`q-img__image ${e.imgClass!==void 0?e.imgClass+" ":""}q-img__image--with${e.noTransition===!0?"out":""}-transition`),R=g(()=>({...e.imgStyle,objectFit:e.fit,objectPosition:e.position}));ae(()=>I(),A);function I(){return e.src||e.srcset||e.sizes?{src:e.src,srcset:e.srcset,sizes:e.sizes}:null}function Q(){return e.placeholderSrc!==void 0?{src:e.placeholderSrc}:null}function A(n){i!==null&&(clearTimeout(i),i=null),f.value=!1,n===null?(p.value=!1,r[u.value^1].value=Q()):p.value=!0,r[u.value].value=n}function K({target:n}){o!==!0&&(i!==null&&(clearTimeout(i),i=null),s.value=n.naturalHeight===0?.5:n.naturalWidth/n.naturalHeight,l(n,1))}function l(n,E){o===!0||E===1e3||(n.complete===!0?L(n):i=setTimeout(()=>{i=null,l(n,E+1)},50))}function L(n){o!==!0&&(u.value=u.value^1,r[u.value].value=null,p.value=!1,f.value=!1,a("load",n.currentSrc||n.src))}function M(n){i!==null&&(clearTimeout(i),i=null),p.value=!1,f.value=!0,r[u.value].value=null,r[u.value^1].value=Q(),a("error",n)}function U(n){const E=r[n].value,T={key:"img_"+n,class:S.value,style:R.value,crossorigin:e.crossorigin,decoding:e.decoding,referrerpolicy:e.referrerpolicy,height:e.height,width:e.width,loading:e.loading,fetchpriority:e.fetchpriority,"aria-hidden":"true",draggable:e.draggable,...E};return u.value===n?(T.class+=" q-img__image--waiting",Object.assign(T,{onLoad:K,onError:M})):T.class+=" q-img__image--loaded",h("div",{class:"q-img__container absolute-full",key:"img"+n},h("img",T))}function X(){return p.value!==!0?h("div",{key:"content",class:"q-img__content absolute-full q-anchor--skip"},j(t[f.value===!0?"error":"default"])):h("div",{key:"loading",class:"q-img__loading absolute-full flex flex-center"},t.loading!==void 0?t.loading():e.noSpinner===!0?void 0:[h(ie,{color:e.spinnerColor,size:e.spinnerSize})])}return A(I()),se(()=>{o=!0,i!==null&&(clearTimeout(i),i=null)}),()=>{const n=[];return y.value!==null&&n.push(h("div",{key:"filler",style:y.value})),f.value!==!0&&(r[0].value!==null&&n.push(U(0)),r[1].value!==null&&n.push(U(1))),n.push(h(ne,{name:"q-transition--fade"},X)),h("div",{class:$.value,style:D.value,role:"img","aria-label":e.alt},n)}}}),pe=B({name:"QPage",props:{padding:Boolean,styleFn:Function},setup(e,{slots:t}){const{proxy:{$q:a}}=F(),s=V(le,_);if(s===_)return console.error("QPage needs to be a deep child of QLayout"),_;if(V(re,_)===_)return console.error("QPage needs to be child of QPageContainer"),_;const i=g(()=>{const r=(s.header.space===!0?s.header.size:0)+(s.footer.space===!0?s.footer.size:0);if(typeof e.styleFn=="function"){const u=s.isContainer.value===!0?s.containerHeight.value:a.screen.height;return e.styleFn(r,u)}return{minHeight:s.isContainer.value===!0?s.containerHeight.value-r+"px":a.screen.height===0?r!==0?`calc(100vh - ${r}px)`:"100vh":a.screen.height-r+"px"}}),o=g(()=>`q-page${e.padding===!0?" q-layout-padding":""}`);return()=>h("main",{class:o.value,style:i.value},j(t.default))}});const Se=ce({name:"IndexPage",setup(){const e=fe();return{store:e,setDevices:s=>e.setDevices(s),isLoggedin:()=>e.isLoggedin()}},mounted(){this.instances=this.store.devices},data(){return{instances:[],qrcode:null,messageQrcode:"",currentKey:null,counter:15,limitInterval:1500,interval:null}},methods:{closeQrcode(){this.messageQrcode="",this.currentKey=null,this.$refs.scanQr.hide(),this.stopCounter()},openQrDialog(e){this.$refs.scanQr.show(),this.fetchQr(e),this.startCounter()},addDeviceDialog(){this.$q.dialog({title:"Add custom key?",message:"biarkan kosong jika ingin menggunakan random key (recomended)",prompt:{model:""},cancel:!0,persistent:!0}).onOk(e=>{this.createInstance(e)}).onCancel(()=>{}).onDismiss(()=>{})},async startCounter(){this.interval=await setInterval(()=>{this.counter===0&&(this.counter=21,this.fetchQr(this.currentKey),this.fetchDetail(this.currentKey)),--this.counter,console.log(this.counter)},this.limitInterval)},stopCounter(){clearInterval(this.interval),this.counter=16,console.log("stop interval",this.counter)},async restoreInstance(){try{let e={Accept:"*/*",Authorization:`Bearer ${this.store.token}`},t=await fetch(`${this.store.baseUrlApi}/instance/restore`,{method:"GET",headers:e});const{data:a}=await t.json();a.length>0?setTimeout(()=>{this.fetchInstance()},2e3):m.create({message:"Tidak ada device yang bisa di restore, silahkan ADD DEVICE",color:"red"})}catch{m.create({message:"Gagal load restore device, silahkan coba lagi",color:"red"})}},async fetchInstance(){try{let e={Accept:"*/*",Authorization:`Bearer ${this.store.token}`},t=await fetch(`${this.store.baseUrlApi}/instance/list`,{method:"GET",headers:e});const{data:a}=await t.json();this.instances=a,this.setDevices(a)}catch{m.create({message:"Gagal mamuat data, silahkan coba beberapa saat lagi",color:"red"})}},async createInstance(e=null){try{let t={Accept:"*/*",Authorization:`Bearer ${this.store.token}`};await(await fetch(`${this.store.baseUrlApi}/instance/init?key=${e}`,{method:"GET",headers:t})).json(),this.fetchInstance(),m.create({message:"Berhasil menambahkan device, silahkan scan qrcode"})}catch{m.create({message:"Gagal menambahkan device, silahkan scan qrcode",color:"red"})}},async fetchDetail(e){var t,a;try{let s={Accept:"*/*",Authorization:`Bearer ${this.store.token}`};(a=(t=(await(await fetch(`${this.store.baseUrlApi}/instance/info?key=${e}`,{method:"GET",headers:s})).json()).instance_data)==null?void 0:t.user)!=null&&a.id&&(this.closeQrcode(),this.fetchInstance())}catch{m.create({message:"Gagal memuat data, silahkan coba setelah beberapa saat",color:"red"})}},async fetchQr(e){try{this.messageQrcode="Sedang memuat qrcode",this.qrcode=null;let t={Accept:"*/*",Authorization:`Bearer ${this.store.token}`},a=await fetch(`${this.store.baseUrlApi}/instance/qrbase64?key=${e}`,{method:"GET",headers:t});const{qrcode:s}=await a.json();return s===" "?this.messageQrcode="instance is expired. silahkan delete dan create ulang instance":(this.messageQrcode="silahkan scan qr code menggunakan aplikasi Whatsapp",this.qrcode=s),this.currentKey=e,s}catch{m.create({message:"Gagal memuat data, silahkan coba setelah beberapa saat",color:"red"})}},async fetchDelete(e){try{let t={Accept:"*/*",Authorization:`Bearer ${this.store.token}`},s=await(await fetch(`${this.store.baseUrlApi}/instance/delete?key=${e}`,{method:"DELETE",headers:t})).json();this.fetchInstance(),m.create({message:"Berhasil menghapus devices.",color:"red"})}catch{m.create({message:"Gagal memuat data, silahkan coba setelah beberapa saat",color:"red"})}},async logoutInstance(e){try{let t={Accept:"*/*",Authorization:`Bearer ${this.store.token}`},s=await(await fetch(`${this.store.baseUrlApi}/instance/logout?key=${e}`,{method:"DELETE",headers:t})).json();this.fetchInstance(),m.create({message:"Device berhasil logout."})}catch{m.create({message:"Gagal memuat data, silahkan coba setelah beberapa saat",color:"red"})}}}}),$e=C("div",{class:"text-h5"},[w(" Silahkan setup "),C("span",{class:"text-bold"}," API URL "),w(" dan "),C("span",{class:"text-bold"}," TOKEN "),w(" terlebih dahulu... ")],-1),_e={key:0,class:"bg-red text-white q-pa-md"},Qe=C("span",{class:"text-h6"},[w(" Belum ada device terdaftar. Silahkan "),C("span",{class:"text-bold"},"ADD DEVICE")],-1),we=[Qe],Be={class:"text-bold"};function De(e,t,a,s,y,i){return v(),b(pe,{class:""},{default:d(()=>[e.isLoggedin()?(v(),b(N,{key:1},{default:d(()=>[c(z,null,{default:d(()=>[c(k,{class:"q-mr-sm",onClick:e.restoreInstance,icon:"refresh",color:"warning",label:"Restore Devices",size:"sm"},null,8,["onClick"]),c(k,{class:"q-mr-sm",onClick:e.fetchInstance,icon:"list",color:"secondary",label:"List Devices",size:"sm"},null,8,["onClick"]),c(k,{class:"q-mr-sm",onClick:e.addDeviceDialog,icon:"add",color:"primary",label:"Add Devices",size:"sm"},null,8,["onClick"])]),_:1}),c(z,null,{default:d(()=>[e.instances.length===0?(v(),H("div",_e,we)):x("",!0),e.instances.length>0?(v(),b(ye,{key:1,bordered:""},{default:d(()=>[(v(!0),H(de,null,ue(e.instances,(o,r)=>(v(),b(ve,{key:r},{default:d(()=>[c(P,null,{default:d(()=>[C("span",Be,G(o.instance_key),1)]),_:2},1024),c(P,null,{default:d(()=>[w(G(o.user),1)]),_:2},1024),c(P,{side:""},{default:d(()=>[C("div",null,[c(k,{label:"delete",onClick:u=>e.fetchDelete(o.instance_key)},null,8,["onClick"]),o.user&&o.user.id?(v(),b(k,{key:0,label:"logout",onClick:u=>e.logoutInstance(o.instance_key)},null,8,["onClick"])):(v(),b(k,{key:1,label:"Scan QRCode",onClick:u=>e.openQrDialog(o.instance_key)},null,8,["onClick"]))])]),_:2},1024)]),_:2},1024))),128))]),_:1})):x("",!0)]),_:1})]),_:1})):(v(),b(N,{key:0,class:"bg-red text-white"},{default:d(()=>[c(z,null,{default:d(()=>[$e]),_:1})]),_:1})),c(me,{ref:"scanQr",persistent:"","transition-show":"scale","transition-hide":"scale"},{default:d(()=>[c(N,{style:{width:"300px"}},{default:d(()=>[c(z,{class:"text-center"},{default:d(()=>[C("div",{class:he(e.qrcode?"bg-primary text-white text-bold q-pa-md":"bg-red text-white text-bold q-pa-md")},G(e.messageQrcode),3),c(Ce,{src:e.qrcode},null,8,["src"]),e.qrcode?(v(),b(k,{key:0,icon:"refresh",label:`refresh qrcode in: ${e.counter}`,onClick:t[0]||(t[0]=o=>e.fetchQr(e.currentKey))},null,8,["label"])):x("",!0)]),_:1}),c(ge,{align:"center",class:""},{default:d(()=>[c(k,{icon:"close",flat:"",label:"close",onClick:e.closeQrcode},null,8,["onClick"])]),_:1})]),_:1})]),_:1},512)]),_:1})}var Ee=oe(Se,[["render",De]]);export{Ee as default};
